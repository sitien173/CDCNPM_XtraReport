/**
* DevExpress Analytics (query-builder\dataSource\json\_jsonSchemaProvider.js)
* Version:  21.2.7
* Build date: Apr 13, 2022
* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED
* License: https://www.devexpress.com/Support/EULAs/universal.xml
*/
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var $ = require("jquery");
var jsonSchemaNode_1 = require("./jsonSchemaNode");
var _infoMessageHelpers_1 = require("../../../core/utils/_infoMessageHelpers");
var _utils_1 = require("../../../property-grid/widgets/internal/_utils");
var localization_utils_1 = require("../../../property-grid/localization/localization_utils");
var _getJsonSchemaCallback = function (requestWrapper, jsonDataSource, parameters) {
    if (parameters === void 0) { parameters = []; }
    var deferred = $.Deferred();
    requestWrapper.getJsonSchema(jsonDataSource, parameters)
        .done(function (data) {
        try {
            var jsonSchema = JSON.parse(data.jsonSchemaJSON);
            var jsonSchemaModel = new jsonSchemaNode_1.JsonSchemaRootNode(jsonSchema);
            deferred.resolve(jsonSchemaModel);
        }
        finally {
            if (deferred.state() === 'pending')
                deferred.reject();
        }
    })
        .fail(function (data) {
        _infoMessageHelpers_1.ShowMessage(_utils_1.formatUnicorn(localization_utils_1.getLocalization('Schema loading failed. {0}', 'DxDesignerStringId.Error_SchemaLoadingFailed'), _infoMessageHelpers_1.getErrorMessage(data)));
        deferred.reject();
    });
    return deferred.promise();
};
exports.getJsonSchemaCallback = _getJsonSchemaCallback;
function _setGetJsonSchemaCallback(func) { exports.getJsonSchemaCallback = func; }
exports._setGetJsonSchemaCallback = _setGetJsonSchemaCallback;
function _resetGetJsonSchemaCallback() { exports.getJsonSchemaCallback = _getJsonSchemaCallback; }
exports._resetGetJsonSchemaCallback = _resetGetJsonSchemaCallback;
